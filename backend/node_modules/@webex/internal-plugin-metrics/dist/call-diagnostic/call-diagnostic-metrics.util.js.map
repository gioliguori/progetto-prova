{"version":3,"names":["_ipAnonymize","_interopRequireDefault","require","_util","_common","_webexCore","_lodash","_config","_BrowserDetection","BrowserDetection","getOSName","getOSVersion","getBrowserName","getBrowserVersion","anonymizeIPAddress","exports","localIp","anonymize","userAgentToString","_ref","clientName","webexVersion","userAgentOption","browserInfo","clientInfo","util","format","concat","indexOf","toLowerCase","split","osInfo","process","env","NODE_ENV","clearEmptyKeysRecursively","obj","_keys","default","length","forEach","key","_typeof2","_isArray","isEmpty","_toConsumableArray2","filter","x","isLocusServiceErrorCode","errorCode","code","charAt","isMeetingInfoServiceError","rawError","_rawError$body","_rawError$body$data","_rawError$body2","_rawError$body2$url","body","data","meetingInfo","url","includes","WBX_APP_API_URL","isNetworkError","WebexHttpError","NetworkOrCORSError","isUnauthorizedError","Unauthorized","isSdpOfferCreationError","name","ERROR_DESCRIPTIONS","SDP_OFFER_CREATION_ERROR","isBrowserMediaErrorName","errorName","BROWSER_MEDIA_ERROR_NAME_TO_CLIENT_ERROR_CODES_MAP","getBuildType","webClientDomain","markAsTestEvent","arguments","undefined","prepareDiagnosticMetricItem","webex","item","_item$eventPayload","_item$eventPayload$ev","_item$eventPayload$ev2","_item$eventPayload2","_item$eventPayload2$e","_item$eventPayload2$e2","_item$eventPayload3","_item$eventPayload3$e","origin","buildType","eventPayload","event","eventData","networkType","eventName","joinTimes","audioSetupDelay","videoSetupDelay","cdl","internal","newMetrics","callDiagnosticLatencies","downloadTime","getDownloadTimeJMT","otherAppApiReqResp","getOtherAppApiReqResp","exchangeCITokenJMT","getExchangeCITokenJMT","meetingInfoReqResp","getMeetingInfoReqResp","clickToInterstitial","getClickToInterstitial","refreshCaptchaServiceReqResp","getRefreshCaptchaReqResp","downloadIntelligenceModelsReqResp","getDownloadIntelligenceModelsReqResp","showInterstitialTime","getShowInterstitialTime","registerWDMDeviceJMT","getRegisterWDMDeviceJMT","getU2CTime","getReachabilityClustersReqResp","callInitJoinReq","getCallInitJoinReq","joinReqResp","getJoinReqResp","pageJmt","getPageJMT","interstitialToJoinOK","getInterstitialToJoinOK","totalJmt","getTotalJMT","clientJmt","getClientJMT","ICESetupTime","getICESetupTime","audioICESetupTime","getAudioICESetupTime","videoICESetupTime","getVideoICESetupTime","shareICESetupTime","getShareICESetupTime","localSDPGenRemoteSDPRecv","getLocalSDPGenRemoteSDPRecv","totalMediaJMT","getTotalMediaJMT","interstitialToMediaOKJMT","getInterstitialToMediaOKJMT","callInitMediaEngineReady","getCallInitMediaEngineReady","stayLobbyTime","getStayLobbyTime","joinRespRxStart","getAudioJoinRespRxStart","joinRespTxStart","getAudioJoinRespTxStart","getVideoJoinRespRxStart","getVideoJoinRespTxStart","merge","_assign","logger","log","_stringify","latencies","Object","fromEntries","latencyTimestamps","setMetricTimings","options","json","_body$metrics","JSON","parse","now","Date","toISOString","metrics","metric","originTime","triggered","sent","extractVersionMetadata","version","_version$split","_version$split2","_slicedToArray2","majorVersion","minorVersion","_parseInt2","generateClientErrorCodeForIceFailure","_ref2","signalingState","iceConnectionState","turnServerUsed","ICE_FAILURE_CLIENT_CODE","MISSING_ROAP_ANSWER_CLIENT_CODE","DTLS_HANDSHAKE_FAILED_CLIENT_CODE","ICE_FAILED_WITH_TURN_TLS_CLIENT_CODE","ICE_FAILED_WITHOUT_TURN_TLS_CLIENT_CODE"],"sources":["call-diagnostic-metrics.util.ts"],"sourcesContent":["/* eslint-disable valid-jsdoc */\nimport anonymize from 'ip-anonymize';\nimport util from 'util';\n\nimport {BrowserDetection} from '@webex/common';\nimport {WebexHttpError} from '@webex/webex-core';\nimport {isEmpty, merge} from 'lodash';\nimport {\n  ClientEvent,\n  Event,\n  MediaQualityEventAudioSetupDelayPayload,\n  MediaQualityEventVideoSetupDelayPayload,\n  MetricEventNames,\n} from '../metrics.types';\nimport {\n  BROWSER_MEDIA_ERROR_NAME_TO_CLIENT_ERROR_CODES_MAP,\n  DTLS_HANDSHAKE_FAILED_CLIENT_CODE,\n  ICE_FAILED_WITHOUT_TURN_TLS_CLIENT_CODE,\n  ICE_FAILED_WITH_TURN_TLS_CLIENT_CODE,\n  ICE_FAILURE_CLIENT_CODE,\n  MISSING_ROAP_ANSWER_CLIENT_CODE,\n  WBX_APP_API_URL,\n  ERROR_DESCRIPTIONS,\n} from './config';\n\nconst {getOSName, getOSVersion, getBrowserName, getBrowserVersion} = BrowserDetection();\n\nexport const anonymizeIPAddress = (localIp) => anonymize(localIp, 28, 96);\n\n/**\n * Returns a formated string of the user agent.\n *\n * @returns {string} formatted user agent information\n */\nexport const userAgentToString = ({clientName, webexVersion}) => {\n  let userAgentOption;\n  let browserInfo;\n  const clientInfo = util.format('client=%s', `${clientName}`);\n\n  if (\n    ['chrome', 'firefox', 'msie', 'msedge', 'safari'].indexOf(getBrowserName().toLowerCase()) !== -1\n  ) {\n    browserInfo = util.format(\n      'browser=%s',\n      `${getBrowserName().toLowerCase()}/${getBrowserVersion().split('.')[0]}`\n    );\n  }\n  const osInfo = util.format('os=%s', `${getOSName()}/${getOSVersion().split('.')[0]}`);\n\n  if (browserInfo) {\n    userAgentOption = `(${browserInfo}`;\n  }\n  if (osInfo) {\n    userAgentOption = userAgentOption\n      ? `${userAgentOption}; ${clientInfo}; ${osInfo}`\n      : `${clientInfo}; (${osInfo}`;\n  }\n  if (userAgentOption) {\n    userAgentOption += ')';\n\n    return util.format(\n      'webex-js-sdk/%s %s',\n      `${process.env.NODE_ENV}-${webexVersion}`,\n      userAgentOption\n    );\n  }\n\n  return util.format('webex-js-sdk/%s', `${process.env.NODE_ENV}-${webexVersion}`);\n};\n\n/**\n * Iterates object recursively and removes any\n * property that returns isEmpty for it's associated value\n * isEmpty = implementation from Lodash.\n *\n * It modifies the object in place (mutable)\n *\n * @param obj - input\n * @returns\n */\nexport const clearEmptyKeysRecursively = (obj: any) => {\n  // Check if the object is empty\n  if (Object.keys(obj).length === 0) {\n    return;\n  }\n\n  Object.keys(obj).forEach((key) => {\n    if (\n      (typeof obj[key] === 'object' || typeof obj[key] === 'string' || Array.isArray(obj[key])) &&\n      isEmpty(obj[key])\n    ) {\n      delete obj[key];\n    }\n    if (Array.isArray(obj[key])) {\n      obj[key] = [...obj[key].filter((x) => !!x)];\n    }\n    if (typeof obj[key] === 'object') {\n      clearEmptyKeysRecursively(obj[key]);\n    }\n  });\n};\n\n/**\n * Locus error codes start with 2. The next three digits are the\n * HTTP status code related to the error code (like 400, 403, 502, etc.)\n * The remaining three digits are just an increasing integer.\n * If it is 7 digits and starts with a 2, it is locus.\n *\n * @param errorCode\n * @returns {boolean}\n */\nexport const isLocusServiceErrorCode = (errorCode: string | number) => {\n  const code = `${errorCode}`;\n\n  if (code.length === 7 && code.charAt(0) === '2') {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * MeetingInfo errors sometimes has body.data.meetingInfo object\n * MeetingInfo errors come with a wbxappapi url\n *\n * @param {Object} rawError\n * @returns {boolean}\n */\nexport const isMeetingInfoServiceError = (rawError: any) => {\n  if (rawError.body?.data?.meetingInfo || rawError.body?.url?.includes(WBX_APP_API_URL)) {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * Returns true if the raw error is a network related error\n *\n * @param {Object} rawError\n * @returns {boolean}\n */\nexport const isNetworkError = (rawError: any) => {\n  if (rawError instanceof WebexHttpError.NetworkOrCORSError) {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * Returns true if the error is an unauthorized error\n *\n * @param {Object} rawError\n * @returns {boolean}\n */\nexport const isUnauthorizedError = (rawError: any) => {\n  if (rawError instanceof WebexHttpError.Unauthorized) {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * Returns true if the error is an SdpOfferCreation error\n *\n * @param {Object} rawError\n * @returns {boolean}\n */\nexport const isSdpOfferCreationError = (rawError: any) => {\n  // would LIKE to do rawError instanceof Errors.SdpOfferCreationError\n  // but including internal-media-core in plugin-metrics breaks meetings and metrics unit tests\n  if (rawError.name === ERROR_DESCRIPTIONS.SDP_OFFER_CREATION_ERROR) {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * MDN Media Devices getUserMedia() method returns a name if it errs\n * Documentation can be found here: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n *\n * @param errorCode\n * @returns\n */\nexport const isBrowserMediaErrorName = (errorName: any) => {\n  if (BROWSER_MEDIA_ERROR_NAME_TO_CLIENT_ERROR_CODES_MAP[errorName]) {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * @param webClientDomain\n * @returns\n */\nexport const getBuildType = (\n  webClientDomain,\n  markAsTestEvent = false\n): Event['origin']['buildType'] => {\n  // used temporary to test pre join in production without creating noise data, SPARK-468456\n  if (markAsTestEvent) {\n    return 'test';\n  }\n\n  if (\n    webClientDomain?.includes('localhost') ||\n    webClientDomain?.includes('127.0.0.1') ||\n    process.env.NODE_ENV !== 'production'\n  ) {\n    return 'test';\n  }\n\n  return 'prod';\n};\n\n/**\n * Prepare metric item for submission.\n * @param {Object} webex sdk instance\n * @param {Object} item\n * @returns {Object} prepared item\n */\nexport const prepareDiagnosticMetricItem = (webex: any, item: any) => {\n  const origin: Partial<Event['origin']> = {\n    buildType: exports.getBuildType(\n      item.eventPayload?.event?.eventData?.webClientDomain,\n      item.eventPayload?.event?.eventData?.markAsTestEvent\n    ),\n    networkType: 'unknown',\n  };\n\n  // check event names and append latencies?\n  const eventName = item.eventPayload?.event?.name as MetricEventNames;\n  const joinTimes: ClientEvent['payload']['joinTimes'] = {};\n  const audioSetupDelay: MediaQualityEventAudioSetupDelayPayload = {};\n  const videoSetupDelay: MediaQualityEventVideoSetupDelayPayload = {};\n\n  const cdl = webex.internal.newMetrics.callDiagnosticLatencies;\n\n  switch (eventName) {\n    case 'client.webexapp.launched':\n      joinTimes.downloadTime = cdl.getDownloadTimeJMT();\n      break;\n    case 'client.login.end':\n      joinTimes.otherAppApiReqResp = cdl.getOtherAppApiReqResp();\n      joinTimes.exchangeCITokenJMT = cdl.getExchangeCITokenJMT();\n      break;\n    case 'client.interstitial-window.launched':\n      joinTimes.meetingInfoReqResp = cdl.getMeetingInfoReqResp();\n      joinTimes.clickToInterstitial = cdl.getClickToInterstitial();\n      joinTimes.refreshCaptchaServiceReqResp = cdl.getRefreshCaptchaReqResp();\n      joinTimes.downloadIntelligenceModelsReqResp = cdl.getDownloadIntelligenceModelsReqResp();\n      break;\n\n    case 'client.call.initiated':\n      joinTimes.meetingInfoReqResp = cdl.getMeetingInfoReqResp();\n      joinTimes.showInterstitialTime = cdl.getShowInterstitialTime();\n      joinTimes.registerWDMDeviceJMT = cdl.getRegisterWDMDeviceJMT();\n      joinTimes.getU2CTime = cdl.getU2CTime();\n      joinTimes.getReachabilityClustersReqResp = cdl.getReachabilityClustersReqResp();\n      break;\n\n    case 'client.locus.join.response':\n      joinTimes.meetingInfoReqResp = cdl.getMeetingInfoReqResp();\n      joinTimes.callInitJoinReq = cdl.getCallInitJoinReq();\n      joinTimes.joinReqResp = cdl.getJoinReqResp();\n      joinTimes.pageJmt = cdl.getPageJMT();\n      joinTimes.clickToInterstitial = cdl.getClickToInterstitial();\n      joinTimes.interstitialToJoinOK = cdl.getInterstitialToJoinOK();\n      joinTimes.totalJmt = cdl.getTotalJMT();\n      joinTimes.clientJmt = cdl.getClientJMT();\n      joinTimes.downloadTime = cdl.getDownloadTimeJMT();\n      break;\n\n    case 'client.ice.end':\n      joinTimes.ICESetupTime = cdl.getICESetupTime();\n      joinTimes.audioICESetupTime = cdl.getAudioICESetupTime();\n      joinTimes.videoICESetupTime = cdl.getVideoICESetupTime();\n      joinTimes.shareICESetupTime = cdl.getShareICESetupTime();\n      break;\n\n    case 'client.media.rx.start':\n      joinTimes.localSDPGenRemoteSDPRecv = cdl.getLocalSDPGenRemoteSDPRecv();\n      break;\n\n    case 'client.media-engine.ready':\n      joinTimes.totalMediaJMT = cdl.getTotalMediaJMT();\n      joinTimes.interstitialToMediaOKJMT = cdl.getInterstitialToMediaOKJMT();\n      joinTimes.callInitMediaEngineReady = cdl.getCallInitMediaEngineReady();\n      joinTimes.stayLobbyTime = cdl.getStayLobbyTime();\n      break;\n\n    case 'client.mediaquality.event':\n      audioSetupDelay.joinRespRxStart = cdl.getAudioJoinRespRxStart();\n      audioSetupDelay.joinRespTxStart = cdl.getAudioJoinRespTxStart();\n      videoSetupDelay.joinRespRxStart = cdl.getVideoJoinRespRxStart();\n      videoSetupDelay.joinRespTxStart = cdl.getVideoJoinRespTxStart();\n  }\n\n  if (!isEmpty(joinTimes)) {\n    item.eventPayload.event = merge(item.eventPayload.event, {joinTimes});\n  }\n\n  if (!isEmpty(audioSetupDelay)) {\n    item.eventPayload.event = merge(item.eventPayload.event, {audioSetupDelay});\n  }\n\n  if (!isEmpty(videoSetupDelay)) {\n    item.eventPayload.event = merge(item.eventPayload.event, {videoSetupDelay});\n  }\n\n  item.eventPayload.origin = Object.assign(origin, item.eventPayload.origin);\n\n  // @ts-ignore\n  webex.logger.log(\n    `CallDiagnosticLatencies,prepareDiagnosticMetricItem: ${JSON.stringify({\n      latencies: Object.fromEntries(cdl.latencyTimestamps),\n      event: item,\n    })}`\n  );\n\n  return item;\n};\n\n/**\n * Sets the originTime value(s) before the request/fetch.\n * This function is only useful if you are about to submit a metrics\n * request using pre-built fetch options;\n *\n * @param {any} options\n * @returns {any} the updated options object\n */\nexport const setMetricTimings = (options) => {\n  if (options.body && options.json) {\n    const body = JSON.parse(options.body);\n\n    const now = new Date().toISOString();\n    body.metrics?.forEach((metric) => {\n      if (metric.eventPayload) {\n        // The event will effectively be triggered and sent at the same time.\n        // The existing triggered time is from when the options were built.\n        metric.eventPayload.originTime = {\n          triggered: now,\n          sent: now,\n        };\n      }\n    });\n    options.body = JSON.stringify(body);\n  }\n\n  return options;\n};\n\nexport const extractVersionMetadata = (version: string) => {\n  // extract major and minor version\n  const [majorVersion, minorVersion] = version.split('.');\n\n  return {\n    majorVersion: parseInt(majorVersion, 10),\n    minorVersion: parseInt(minorVersion, 10),\n  };\n};\n\n/**\n * Generates client error codes for specific ice failures\n * that happen when trying to add media in a meeting.\n */\nexport const generateClientErrorCodeForIceFailure = ({\n  signalingState,\n  iceConnectionState,\n  turnServerUsed,\n}: {\n  signalingState: RTCPeerConnection['signalingState'];\n  iceConnectionState: RTCPeerConnection['iceConnectionState'];\n  turnServerUsed: boolean;\n}) => {\n  let errorCode = ICE_FAILURE_CLIENT_CODE; // default;\n\n  if (signalingState === 'have-local-offer') {\n    errorCode = MISSING_ROAP_ANSWER_CLIENT_CODE;\n  }\n\n  if (\n    signalingState === 'stable' &&\n    (iceConnectionState === 'connected' || iceConnectionState === 'disconnected')\n  ) {\n    errorCode = DTLS_HANDSHAKE_FAILED_CLIENT_CODE;\n  }\n\n  if (\n    signalingState !== 'have-local-offer' &&\n    iceConnectionState !== 'connected' &&\n    iceConnectionState !== 'disconnected'\n  ) {\n    if (turnServerUsed) {\n      errorCode = ICE_FAILED_WITH_TURN_TLS_CLIENT_CODE;\n    } else {\n      errorCode = ICE_FAILED_WITHOUT_TURN_TLS_CLIENT_CODE;\n    }\n  }\n\n  return errorCode;\n};\n"],"mappings":"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"}