{"version":3,"names":["_httpCore","require","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","default","result","NewTarget","constructor","_Reflect$construct","arguments","apply","_possibleConstructorReturn2","Reflect","sham","Proxy","Boolean","prototype","valueOf","call","e","trailingSlashes","ServiceInterceptor","exports","_Interceptor","_inherits2","_super","_classCallCheck2","_createClass2","key","value","onRequest","options","_this","uri","normalizeOptions","validateOptions","services","webex","internal","service","resource","waitForServiceTimeout","waitForService","name","timeout","then","serviceUrl","generateUri","catch","_promise","reject","Error","concat","length","undefined","formattedService","replace","formattedResource","api","create","Interceptor"],"sources":["service.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {Interceptor} from '@webex/http-core';\n\nconst trailingSlashes = /(?:^\\/)|(?:\\/$)/;\n\n/**\n * @class\n */\nexport default class ServiceInterceptor extends Interceptor {\n  /**\n   * @returns {ServiceInterceptor}\n   */\n  static create() {\n    /* eslint no-invalid-this: [0] */\n    return new ServiceInterceptor({webex: this});\n  }\n\n  /* eslint-disable no-param-reassign */\n  /**\n   * @see Interceptor#onRequest\n   * @param {Object} options - The request PTO.\n   * @returns {Object} - The mutated request PTO.\n   */\n  onRequest(options) {\n    // Validate that the PTO includes a uri property.\n    if (options.uri) {\n      return options;\n    }\n\n    // Normalize and validate the PTO.\n    this.normalizeOptions(options);\n    this.validateOptions(options);\n\n    // Destructure commonly referenced namespaces.\n    const {services} = this.webex.internal;\n    const {service, resource, waitForServiceTimeout} = options;\n\n    // Attempt to collect the service url.\n    return services\n      .waitForService({name: service, timeout: waitForServiceTimeout})\n      .then((serviceUrl) => {\n        // Generate the combined service url and resource.\n        options.uri = this.generateUri(serviceUrl, resource);\n\n        return options;\n      })\n      .catch(() =>\n        Promise.reject(new Error(`service-interceptor: '${service}' is not a known service`))\n      );\n  }\n\n  /* eslint-disable class-methods-use-this */\n  /**\n   * Generate a usable request uri string from a service url and a resouce.\n   *\n   * @param {string} serviceUrl - The service url.\n   * @param {string} [resource] - The resouce to be appended to the service url.\n   * @returns {string} - The combined service url and resource.\n   */\n  generateUri(serviceUrl, resource = '') {\n    const formattedService = serviceUrl.replace(trailingSlashes, '');\n    const formattedResource = resource.replace(trailingSlashes, '');\n\n    return `${formattedService}/${formattedResource}`;\n  }\n\n  /**\n   * Normalizes request options relative to service identification.\n   *\n   * @param {Object} options - The request PTO.\n   * @returns {Object} - The mutated request PTO.\n   */\n  normalizeOptions(options) {\n    // Validate if the api property is used.\n    if (options.api) {\n      // Assign the service property the value of the api property if necessary.\n      options.service = options.service || options.api;\n      delete options.api;\n    }\n  }\n\n  /**\n   * Validates that the appropriate options for this interceptor are present.\n   *\n   * @param {Object} options - The request PTO.\n   * @returns {Object} - The mutated request PTO.\n   */\n  validateOptions(options) {\n    if (!options.resource) {\n      throw new Error('a `resource` parameter is required');\n    }\n\n    if (!options.service) {\n      throw new Error(\"a valid 'service' parameter is required\");\n    }\n  }\n  /* eslint-enable class-methods-use-this, no-param-reassign */\n}\n"],"mappings":"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"}