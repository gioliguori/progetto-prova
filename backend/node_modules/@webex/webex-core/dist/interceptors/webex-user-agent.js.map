{"version":3,"names":["_common","require","_httpCore","_lodash","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","default","result","NewTarget","constructor","_Reflect$construct","arguments","apply","_possibleConstructorReturn2","Reflect","sham","Proxy","Boolean","prototype","valueOf","call","e","strings","_weakMap","WebexUserAgentInterceptor","exports","_Interceptor","_inherits2","_super","_this","options","length","undefined","_classCallCheck2","libName","get","libVersion","set","_assertThisInitialized2","concat","inBrowser","_createClass2","key","value","onRequest","_this$webex$config","_this$webex","headers","_ref","webex","config","appName","appVersion","appPlatform","sparkUserAgent","uri","includes","credentials","samlUrl","tokenUrl","authorizeUrl","_deleteProperty","create","Interceptor"],"sources":["webex-user-agent.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {inBrowser} from '@webex/common';\nimport {Interceptor} from '@webex/http-core';\nimport {get} from 'lodash';\n\nconst strings = new WeakMap();\n\n/**\n * @class\n */\nexport default class WebexUserAgentInterceptor extends Interceptor {\n  /**\n   * @param {Object} [options={}]\n   * @param {WebexCore} [options.webex]\n   * @private\n   * @returns {WebexUserAgentInterceptor}\n   */\n  constructor(options = {}) {\n    const libName = get(options, 'webex.webex', false) ? 'webex' : 'webex-js-sdk';\n    const libVersion = get(options, 'webex.version', 'development');\n\n    super(options);\n    strings.set(this, `${libName}/${libVersion} (${inBrowser ? 'web' : 'node'})`);\n  }\n\n  /**\n   * @returns {WebexUserAgentInterceptor}\n   */\n  static create() {\n    return new WebexUserAgentInterceptor({webex: this});\n  }\n\n  /**\n   * @see Interceptor#onRequest\n   * @param {Object} options\n   * @returns {Object}\n   */\n  onRequest(options) {\n    options.headers = options.headers || {};\n    const {appName, appVersion, appPlatform} = this.webex?.config ?? {};\n    let sparkUserAgent = `${strings.get(this)}`;\n\n    if (appName) {\n      sparkUserAgent += ` ${appName}/${appVersion ?? '0.0'}`;\n    }\n\n    if (appPlatform) {\n      sparkUserAgent += ` ${appPlatform}`;\n    }\n\n    if (options.uri && options.uri.includes('https://idbroker')) {\n      return options;\n    }\n\n    if (\n      options.uri &&\n      (options.uri.includes(this.webex.config.credentials.samlUrl) ||\n        options.uri.includes(this.webex.config.credentials.tokenUrl) ||\n        options.uri.includes(this.webex.config.credentials.authorizeUrl))\n    ) {\n      return options;\n    }\n\n    if ('spark-user-agent' in options.headers) {\n      if (!options.headers['spark-user-agent']) {\n        Reflect.deleteProperty(options.headers, 'spark-user-agent');\n      }\n\n      return options;\n    }\n\n    options.headers['spark-user-agent'] = sparkUserAgent;\n\n    return options;\n  }\n}\n"],"mappings":"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"}