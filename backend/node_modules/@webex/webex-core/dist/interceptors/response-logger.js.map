{"version":3,"names":["_util","_interopRequireDefault","require","_lodash","_httpCore","_common","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","default","result","NewTarget","constructor","_Reflect$construct","arguments","apply","_possibleConstructorReturn2","Reflect","sham","Proxy","Boolean","prototype","valueOf","call","e","ResponseLoggerInterceptor","exports","_Interceptor","_inherits2","_super","_classCallCheck2","_createClass2","key","value","onResponse","options","response","now","Date","printResponseHeader","logger","get","console","process","env","ENABLE_VERBOSE_NETWORK_LOGGING","info","getTime","toISOString","body","isBuffer","_typeof2","util","inspect","omit","depth","err","onResponseError","reason","error","_promise","reject","statusCode","$timings","networkEnd","networkStart","requestEnd","requestStart","create","webex","Interceptor"],"sources":["response-logger.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport util from 'util';\n\nimport {get, omit} from 'lodash';\nimport {Interceptor} from '@webex/http-core';\nimport {isBuffer} from '@webex/common';\n\n/**\n * @class\n */\nexport default class ResponseLoggerInterceptor extends Interceptor {\n  /**\n   * @returns {ResponseLoggerInterceptor}\n   */\n  static create() {\n    return new ResponseLoggerInterceptor({webex: this});\n  }\n\n  /**\n   * @see Interceptor#onRequest\n   * @param {Object} options\n   * @param {HttpResponse} response\n   * @returns {Object}\n   */\n  onResponse(options, response) {\n    const now = new Date();\n\n    this.printResponseHeader(options, response);\n\n    const logger = get(this, 'webex.logger', console);\n\n    if (process.env.ENABLE_VERBOSE_NETWORK_LOGGING) {\n      logger.info('timestamp (end): ', now.getTime(), now.toISOString());\n      if (typeof response.body === 'string' || isBuffer(response.body)) {\n        logger.info('Response: ', 'Not printed, it`s probably a file');\n      } else if (typeof response.body === 'object') {\n        try {\n          logger.info('Response: ', util.inspect(omit(response.body, 'features'), {depth: null}));\n        } catch (err) {\n          logger.info('Response: ', '[Not Serializable]', err);\n        }\n      }\n    }\n    logger.info('\\\\**********************************************************************/');\n\n    return response;\n  }\n\n  /**\n   * @see Interceptor#onRequest\n   * @param {Object} options\n   * @param {Object} reason\n   * @returns {Object}\n   */\n  onResponseError(options, reason) {\n    const now = new Date();\n\n    this.printResponseHeader(options, reason);\n\n    const logger = get(this, 'webex.logger', console);\n\n    if (process.env.ENABLE_VERBOSE_NETWORK_LOGGING) {\n      logger.info('timestamp (end): ', now.getTime(), now.toISOString());\n      try {\n        logger.error('Response: ', util.inspect(reason.body, {depth: null}));\n      } catch (err) {\n        logger.error('Response: ', reason.body);\n      }\n    }\n    logger.info('\\\\**********************************************************************/');\n\n    return Promise.reject(reason);\n  }\n\n  /**\n   * Prints the basic header\n   * @param {Object} options\n   * @param {HttpResponse|WebexHttpError} response\n   * @returns {undefined}\n   */\n  printResponseHeader(options, response) {\n    const logger = get(this, 'webex.logger', console);\n\n    logger.info('Status Code:', response.statusCode);\n    logger.info(\n      'WEBEX_TRACKINGID:',\n      get(options, 'headers.trackingid') || get(response, 'headers.trackingid')\n    );\n    logger.info('Network duration:', options.$timings.networkEnd - options.$timings.networkStart);\n    logger.info(\n      'Processing duration:',\n      options.$timings.requestEnd - options.$timings.requestStart\n    );\n  }\n}\n"],"mappings":"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"}