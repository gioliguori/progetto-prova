{"version":3,"names":["_events","require","intercept","options","interceptors","key","res","arguments","length","undefined","successKey","concat","errorKey","reduce","promise","interceptor","then","result","logOptions","_promise","default","resolve","reason","reject","prepareFetchOptions","_x","_prepareFetchOptions","apply","_asyncToGenerator2","_regenerator","mark","_callee","wrap","_callee$","_context","prev","next","url","uri","headers","json","accept","Accept","method","body","_stringify","_deleteProperty","download","EventEmitter","upload","keepalive","abrupt","stop"],"sources":["utils.ts"],"sourcesContent":["/* eslint-disable import/prefer-default-export */\nimport {EventEmitter} from 'events';\nimport Interceptor from '../lib/interceptor';\n\n/**\n * @param {Object} options\n * @param {Array<Object>} interceptors\n * @param {string} key\n * @param {Object | undefined} res\n * @private\n * @returns {Promise}\n */\nexport function intercept(\n  options: object,\n  interceptors: Array<Interceptor>,\n  key: string,\n  res: object = undefined\n): Promise<any> {\n  const successKey = `on${key}`;\n  const errorKey = `on${key}Error`;\n\n  return interceptors.reduce(\n    (promise, interceptor) =>\n      promise.then(\n        (result) => {\n          interceptor.logOptions(options);\n          if (interceptor[successKey]) {\n            return interceptor[successKey](options, result);\n          }\n\n          return Promise.resolve(result);\n        },\n        (reason) => {\n          interceptor.logOptions(options);\n          if (interceptor[errorKey]) {\n            return interceptor[errorKey](options, reason);\n          }\n\n          return Promise.reject(reason);\n        }\n      ),\n    Promise.resolve(res)\n  );\n}\n\n/**\n * Prepare options for a fetch.\n * @param {object} options\n * @returns {Promise}\n */\nexport async function prepareFetchOptions(options: any): Promise<any> {\n  if (options.url) {\n    options.uri = options.url;\n    options.url = null;\n  }\n\n  options.headers = options.headers || {};\n\n  if (options.json) {\n    // don't override existing accept header declared by user\n    options.headers.accept = options.headers.accept || options.headers.Accept || 'application/json';\n\n    // don't override existing content-type header declared by user\n    if (options.method !== 'GET' && options.method !== 'HEAD') {\n      options.headers['content-type'] =\n        options.headers['content-type'] || options.headers['Content-Type'] || 'application/json';\n      options.body = JSON.stringify(options.json === true ? options.body : options.json);\n    }\n  } else if (options.json !== undefined) {\n    Reflect.deleteProperty(options, 'json');\n  }\n\n  options.download = new EventEmitter();\n  options.upload = new EventEmitter();\n  options.keepalive = true;\n\n  return intercept(options, options.interceptors, 'Request').then(() => options);\n}\n"],"mappings":"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"}