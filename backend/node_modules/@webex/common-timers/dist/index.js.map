{"version":3,"names":["safeSetTimeout","timer","setTimeout","apply","arguments","unref","safeSetInterval","interval","setInterval","Timer","exports","callback","timeout","_this","_classCallCheck2","default","_defineProperty2","state","_createClass2","key","value","start","Error","concat","startTimer","reset","clearTimer","cancel","currentTimer","clearTimeout"],"sources":["index.ts"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\n/**\n * Wrapper around setTimout which (in node) unrefs the returned timer to avoid\n * wedging the process open unexpectedly.\n * @param {Mixed} args\n * @protected\n * @returns {NodeJS.Timeout|Number}\n */\nexport function safeSetTimeout(...args: Parameters<typeof setTimeout>): number | NodeJS.Timeout {\n  const timer = setTimeout(...args);\n\n  if (timer.unref) {\n    timer.unref();\n  }\n\n  return timer;\n}\n\n/**\n * Wrapper around setInterval which (in node) unrefs the returned timer to avoid\n * wedging the process open unexpectedly.\n * @param {Mixed} args\n * @protected\n * @returns {NodeJS.Timeout|Number}\n */\nexport function safeSetInterval(...args: Parameters<typeof setInterval>): number | NodeJS.Timeout {\n  const interval = setInterval(...args);\n\n  if (interval.unref) {\n    interval.unref();\n  }\n\n  return interval;\n}\n\n/**\n * Create a restartable timer\n */\nexport class Timer {\n  private state: 'init' | 'running' | 'done';\n  private readonly timeout: number;\n  private readonly callback: () => void;\n  private currentTimer: number | NodeJS.Timeout;\n\n  /**\n   * Construct timer\n   * @param {Function} callback Function called when the timer expired\n   * @param {number} timeout duration of the timeout in milliseconds\n   */\n  constructor(callback: () => void, timeout: number) {\n    this.state = 'init';\n    this.timeout = timeout;\n    this.callback = () => {\n      this.state = 'done';\n      callback();\n    };\n  }\n\n  /**\n   * Start timer\n   * @returns {void}\n   */\n  start() {\n    if (this.state !== 'init') {\n      throw new Error(`Can't start the timer when it's in ${this.state} state`);\n    }\n\n    this.startTimer();\n    this.state = 'running';\n  }\n\n  /**\n   * Clear the current timer and start a new one\n   * @returns {void}\n   */\n  reset() {\n    if (this.state !== 'running') {\n      throw new Error(`Can't reset the timer when it's in ${this.state} state`);\n    }\n    this.clearTimer();\n    this.startTimer();\n  }\n\n  /**\n   * Clear the timer\n   * @returns {void}\n   */\n  cancel() {\n    if (this.state !== 'running') {\n      throw new Error(`Can't cancel the timer when it's in ${this.state} state`);\n    }\n    this.clearTimer();\n    this.state = 'done';\n  }\n\n  /**\n   * Create the actual timer\n   * @private\n   * @returns {undefined}\n   */\n  private startTimer() {\n    this.currentTimer = safeSetTimeout(this.callback, this.timeout);\n  }\n\n  /**\n   * Clear the actual timer\n   * @private\n   * @returns {undefined}\n   */\n  private clearTimer() {\n    clearTimeout(this.currentTimer);\n  }\n}\n"],"mappings":";;;;;;;;;;;;;AAAA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,cAAcA,CAAA,EAAkE;EAC9F,IAAMC,KAAK,GAAGC,UAAU,CAAAC,KAAA,SAAAC,SAAQ,CAAC;EAEjC,IAAIH,KAAK,CAACI,KAAK,EAAE;IACfJ,KAAK,CAACI,KAAK,CAAC,CAAC;EACf;EAEA,OAAOJ,KAAK;AACd;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASK,eAAeA,CAAA,EAAmE;EAChG,IAAMC,QAAQ,GAAGC,WAAW,CAAAL,KAAA,SAAAC,SAAQ,CAAC;EAErC,IAAIG,QAAQ,CAACF,KAAK,EAAE;IAClBE,QAAQ,CAACF,KAAK,CAAC,CAAC;EAClB;EAEA,OAAOE,QAAQ;AACjB;;AAEA;AACA;AACA;AAFA,IAGaE,KAAK,GAAAC,OAAA,CAAAD,KAAA;EAMhB;AACF;AACA;AACA;AACA;EACE,SAAAA,MAAYE,QAAoB,EAAEC,OAAe,EAAE;IAAA,IAAAC,KAAA;IAAA,IAAAC,gBAAA,CAAAC,OAAA,QAAAN,KAAA;IAAA,IAAAO,gBAAA,CAAAD,OAAA;IAAA,IAAAC,gBAAA,CAAAD,OAAA;IAAA,IAAAC,gBAAA,CAAAD,OAAA;IAAA,IAAAC,gBAAA,CAAAD,OAAA;IACjD,IAAI,CAACE,KAAK,GAAG,MAAM;IACnB,IAAI,CAACL,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACD,QAAQ,GAAG,YAAM;MACpBE,KAAI,CAACI,KAAK,GAAG,MAAM;MACnBN,QAAQ,CAAC,CAAC;IACZ,CAAC;EACH;;EAEA;AACF;AACA;AACA;EAHE,IAAAO,aAAA,CAAAH,OAAA,EAAAN,KAAA;IAAAU,GAAA;IAAAC,KAAA,EAIA,SAAAC,MAAA,EAAQ;MACN,IAAI,IAAI,CAACJ,KAAK,KAAK,MAAM,EAAE;QACzB,MAAM,IAAIK,KAAK,uCAAAC,MAAA,CAAuC,IAAI,CAACN,KAAK,WAAQ,CAAC;MAC3E;MAEA,IAAI,CAACO,UAAU,CAAC,CAAC;MACjB,IAAI,CAACP,KAAK,GAAG,SAAS;IACxB;;IAEA;AACF;AACA;AACA;EAHE;IAAAE,GAAA;IAAAC,KAAA,EAIA,SAAAK,MAAA,EAAQ;MACN,IAAI,IAAI,CAACR,KAAK,KAAK,SAAS,EAAE;QAC5B,MAAM,IAAIK,KAAK,uCAAAC,MAAA,CAAuC,IAAI,CAACN,KAAK,WAAQ,CAAC;MAC3E;MACA,IAAI,CAACS,UAAU,CAAC,CAAC;MACjB,IAAI,CAACF,UAAU,CAAC,CAAC;IACnB;;IAEA;AACF;AACA;AACA;EAHE;IAAAL,GAAA;IAAAC,KAAA,EAIA,SAAAO,OAAA,EAAS;MACP,IAAI,IAAI,CAACV,KAAK,KAAK,SAAS,EAAE;QAC5B,MAAM,IAAIK,KAAK,wCAAAC,MAAA,CAAwC,IAAI,CAACN,KAAK,WAAQ,CAAC;MAC5E;MACA,IAAI,CAACS,UAAU,CAAC,CAAC;MACjB,IAAI,CAACT,KAAK,GAAG,MAAM;IACrB;;IAEA;AACF;AACA;AACA;AACA;EAJE;IAAAE,GAAA;IAAAC,KAAA,EAKA,SAAAI,WAAA,EAAqB;MACnB,IAAI,CAACI,YAAY,GAAG5B,cAAc,CAAC,IAAI,CAACW,QAAQ,EAAE,IAAI,CAACC,OAAO,CAAC;IACjE;;IAEA;AACF;AACA;AACA;AACA;EAJE;IAAAO,GAAA;IAAAC,KAAA,EAKA,SAAAM,WAAA,EAAqB;MACnBG,YAAY,CAAC,IAAI,CAACD,YAAY,CAAC;IACjC;EAAC;EAAA,OAAAnB,KAAA;AAAA"}